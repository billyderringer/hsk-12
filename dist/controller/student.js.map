{"version":3,"sources":["../../src/controller/student.js"],"names":["api","post","req","res","findById","params","termId","err","term","send","newStudent","firstName","body","lastName","gradeLevel","teacher","_id","save","students","push","json","message","patch","studentId","student","undefined","get","find","console","log","delete","id","pull","remove","subject","status","assignment"],"mappings":"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","file":"student.js","sourcesContent":["import {Router} from 'express'\r\nimport { authenticate } from '../middleware/authMiddleware'\r\n\r\nimport SchoolTerm from '../model/schoolTerm'\r\nimport Student from '../model/student'\r\nimport Assignment from \"../model/assignment\"\r\nimport Subject from \"../model/subject\"\r\n\r\nexport default () => {\r\n    let api = Router()\r\n\r\n    // '/student/...' - Create new student\r\n    api.post('/create/:termId', authenticate, (req, res) => {\r\n        SchoolTerm.findById(req.params.termId, (err, term) => {\r\n            if(err){\r\n                res.send(err+' :err finding term by id')\r\n            }\r\n            let newStudent = new Student();\r\n            newStudent.firstName = req.body.firstName\r\n            newStudent.lastName = req.body.lastName\r\n            newStudent.gradeLevel = req.body.gradeLevel\r\n            newStudent.teacher = term.teacher\r\n            newStudent.term = term._id\r\n            newStudent.save(err => {\r\n                if (err) {\r\n                    res.send(err+' :err saving new student')\r\n                }\r\n                term.students.push(newStudent)\r\n                term.save(err => {\r\n                    if(err){\r\n                        res.send(err+' :err saving student to term')\r\n                    }\r\n                    res.json({message: 'new student saved'})\r\n                })\r\n            })\r\n        })\r\n    })\r\n\r\n    // Update student basic info\r\n    api.patch('/update/:studentId', authenticate, (req, res) => {\r\n        Student.findById(req.params.studentId, (err, student) => {\r\n            if (err) {\r\n                res.send(err)\r\n            }\r\n            if (req.body.firstName !== undefined) {\r\n                student.firstName = req.body.firstName\r\n            }\r\n            if (req.body.lastName !== undefined) {\r\n                student.lastName = req.body.lastName\r\n            }\r\n            if (req.body.gradeLevel !== undefined) {\r\n                student.gradeLevel = req.body.gradeLevel\r\n            }\r\n\r\n            student.save(err => {\r\n                if (err) {\r\n                    res.send(err)\r\n                }\r\n                res.json({message: 'student info updated successfully'})\r\n            })\r\n        })\r\n    })\r\n\r\n    // Get students by termId\r\n    api.get('/term/:termId', (req, res) => {\r\n        Student.find({term: req.params.termId}, (err, students) => {\r\n            if(students === null){\r\n                res.json('students not found')\r\n            }\r\n            else if (err) {\r\n                res.send(err)\r\n            }\r\n            else {\r\n                res.json(students)\r\n            }\r\n        })\r\n    })\r\n\r\n    //Get student by id\r\n    api.get('/:studentId', (req, res) => {\r\n        Student.findById(req.params.studentId, (err, student) => {\r\n            console.log(student)\r\n            if(student === null){\r\n                res.json('student not found')\r\n            }\r\n            else if (err) {\r\n                res.send(err);\r\n            }\r\n            else {\r\n                res.json(student);\r\n            }\r\n        });\r\n    })\r\n\r\n    // Delete student\r\n    api.delete('/remove/:studentId', authenticate, (req, res) => {\r\n        let id = req.params.studentId\r\n\r\n        Student.findById(id, (err, student) => {\r\n            if (err) {\r\n                res.send(err + ' :err finding student by id')\r\n            }\r\n            SchoolTerm.find({students: id}, (err, term) => {\r\n                if (err) {\r\n                    res.send(err + ' :err finding term by studentId')\r\n                }\r\n                term[0].students.pull(student)\r\n                term[0].save(err => {\r\n                    if (err) {\r\n                        res.send(err + ' :err saving term')\r\n                    }\r\n                })\r\n            })\r\n            Student.remove({_id: req.params.studentId}, err => {\r\n                if (err) {\r\n                    res.send(err + ' :err removing Student')\r\n                }\r\n                Subject.remove({student: id}, (err, subject) => {\r\n                    if (err) {\r\n                        res.send(err+' :err removing subject in student')\r\n                    }\r\n                    if (subject === null) {\r\n                        res.status(404).send(\"subject not found\")\r\n                    }\r\n\r\n                    Assignment.remove({student: id}, (err, assignment) => {\r\n                        if (err) {\r\n                            res.send(err+' :err removing assignment in student')\r\n                        }\r\n                        if (assignment === null) {\r\n                            res.status(404).send(\"assignment not found\")\r\n                        }\r\n                    })\r\n                })\r\n            })\r\n        })\r\n        res.json({message: \"student successfully removed\"})\r\n    })\r\n\r\n    return api\r\n}"]}