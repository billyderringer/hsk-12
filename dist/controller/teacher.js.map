{"version":3,"sources":["../../src/controller/teacher.js"],"names":["config","db","api","teacherCount","post","req","res","register","username","body","email","password","err","teacher","send","authenticate","session","status","scope","get","logout","json","user","findById","params","roomId","homeroom","newTeacher","firstName","lastName","homerooms","hub","teachers","push","save","message","roomName","find","id","teacherId","students","patch","undefined","teacherName","studentId","student","studentName","delete","pull","remove"],"mappings":"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","file":"teacher.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport {Router} from 'express';\r\nimport Hub from '../model/hub';\r\nimport Homeroom from '../model/homeroom';\r\nimport Teacher from '../model/teacher';\r\nimport Student from '../model/student';\r\nimport passport from 'passport';\r\nimport {generateAccessToken, respond, authenticate} from '../middleware/authMiddleware';\r\n\r\nexport default ({config, db}) => {\r\n    let api = Router();\r\n    let teacherCount = 0;\r\n\r\n    // '/teacher/register' - Create new teachers\r\n    api.post('/register', (req, res) => {\r\n        Teacher.register(new Teacher({\r\n            username: req.body.email\r\n        }), req.body.password, (err, teacher) => {\r\n            if(err){\r\n                res.send(err);\r\n            }\r\n            passport.authenticate(\r\n                'local', {\r\n                    session: false\r\n                })(req, res, () => {\r\n                res.status(200).send('Successfully created new account');\r\n            });\r\n        });\r\n    });\r\n\r\n    api.post('/login', passport.authenticate(\r\n        'local', {\r\n            session: false,\r\n            scope: []\r\n        }), generateAccessToken, respond);\r\n\r\n    // 'v1/account/logout' - Logout\r\n    api.get('/logout', authenticate, (req, res) => {\r\n        res.logout();\r\n        res.status(200).send('Successfully logged out');\r\n    });\r\n\r\n    api.get('/me', authenticate, (req, res) => {\r\n        res.status(200).json(req.user);\r\n    });\r\n\r\n\r\n\r\n    // '/teacher/:roomId' - Create new teachers\r\n    api.post('/:roomId', (req, res) => {\r\n        Homeroom.findById(req.params.roomId, (err, homeroom) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            let newTeacher = new Teacher();\r\n            newTeacher.firstName = req.body.firstName;\r\n            newTeacher.lastName = req.body.lastName;\r\n            newTeacher.homerooms = req.params.roomId;\r\n            newTeacher.hub = homeroom.hub;\r\n            Hub.findById(newTeacher.hub, (err, hub) => {\r\n                if(err){\r\n                    res.send(err);\r\n                }\r\n                hub.teachers.push(newTeacher);\r\n                hub.save(err => {\r\n                    if(err){\r\n                        res.send(err);\r\n                    }\r\n                });\r\n            });\r\n            newTeacher.save((err, teacher) => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                homeroom.teachers.push(newTeacher);\r\n                homeroom.save(err => {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                });\r\n                teacher.save(err => {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                    teacherCount++;\r\n                    res.json({message: 'Teacher: ' + newTeacher.firstName + ' ' + newTeacher.lastName + ' successfully added to ' + homeroom.roomName});\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    // '/teacher' - Read all teachers\r\n    api.get('/', (req, res) => {\r\n        Teacher.find({}, (err, teachers) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(teachers);\r\n        });\r\n    });\r\n\r\n    // '/teacher/:roomId' - Read all teachers by classId\r\n    api.get('/:roomId', (req, res) => {\r\n        let id = req.params.roomId;\r\n        Teacher.find({homerooms: id}, (err, teachers) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(teachers);\r\n        });\r\n    });\r\n\r\n    // '/teacher/:teacherId/students' - Read students by teacherId\r\n    api.get('/:teacherId/students', (req, res) => {\r\n        let id = req.params.teacherId;\r\n        Teacher.find({students: id}, (err, students) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(students);\r\n        });\r\n    });\r\n\r\n    // '/teacher/:teacherId' - Read teacher by teacherId\r\n    api.get('/:teacherId', (req, res) => {\r\n        Teacher.findById(req.params.teacherId, (err, teacher) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(teacher);\r\n        });\r\n    });\r\n\r\n    // '/teacher/:id' - Update teacher basic info\r\n    api.patch('/update/:teacherId', (req, res) => {\r\n        Teacher.findById(req.params.teacherId, (err, teacher) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            if(req.body.firstName !== undefined) {\r\n                teacher.firstName = req.body.firstName;\r\n            }\r\n            if(req.body.lastName !== undefined) {\r\n                teacher.lastName = req.body.lastName;\r\n            }\r\n            teacher.save(err => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                res.json({message: teacher.firstName + ' ' + teacher.lastName + ': Info updated successfully'});\r\n            });\r\n        });\r\n    });\r\n\r\n    // '/teacher/:teacherId/assign/:studentId' - Assign students to teacher\r\n    api.post('/:teacherId/assign/:studentId', (req, res) => {\r\n        Teacher.findById(req.params.teacherId, (err, teacher) => {\r\n            let teacherName = teacher.firstName + ' ' + teacher.lastName;\r\n            if(err){\r\n                res.send(err);\r\n            }\r\n            Student.findById(req.params.studentId, (err, student) => {\r\n                let studentName = student.firstName + ' ' + student.lastName;\r\n                if(err){\r\n                    res.send(err);\r\n                }\r\n                teacher.students.push(student);\r\n                teacher.save(err => {\r\n                    if(err){\r\n                        res.send(err);\r\n                    }\r\n                });\r\n                student.teachers.push(teacher);\r\n                student.save(err => {\r\n                    if(err){\r\n                        res.send(err);\r\n                    }\r\n                });\r\n                res.json({message: studentName + ' successfully assigned to ' + teacherName});\r\n            });\r\n        });\r\n    });\r\n\r\n    // '/teacher/:teacherId' - Delete teacher\r\n    api.delete('/remove/:teacherId', (req, res) => {\r\n        Teacher.findById(req.params.teacherId, (err, teacher) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            Hub.findById(teacher.hub, (err, hub) => {\r\n                if(err){\r\n                    res.send(err);\r\n                }\r\n                hub.teachers.pull(teacher);\r\n                hub.save(err => {\r\n                    if(err){\r\n                        res.send(err);\r\n                    }\r\n                });\r\n            });\r\n            Homeroom.findById(teacher.homerooms, (err, homeroom) => {\r\n                if(err){\r\n                    res.send(err);\r\n                }\r\n                homeroom.teachers.pull(teacher);\r\n                homeroom.save(err => {\r\n                    if(err){\r\n                        res.send(err);\r\n                    }\r\n                });\r\n            });\r\n\r\n            Teacher.remove(teacher, err => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                res.json({message: \"Teacher successfully removed\"});\r\n            });\r\n        });\r\n    });\r\n\r\n    return api;\r\n}"]}