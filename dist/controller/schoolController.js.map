{"version":3,"sources":["../../src/controller/schoolController.js"],"names":["config","db","api","post","req","res","newHub","hubName","body","save","err","send","json","message","get","find","hub","findById","params","schoolId","school","teachers","students","put","roomName","delete","remove","_id","id","deletedHub","idClassRooms","classrooms","idTeachers","idStudents"],"mappings":"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","file":"schoolController.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport {Router} from 'express';\r\nimport School from '../model/schoolModel';\r\nimport Classroom from '../model/classroomModel';\r\nimport Teacher from '../model/teacherModel';\r\nimport Student from '../model/studentModel';\r\n\r\nexport default ({config, db}) => {\r\n    let api = Router();\r\n\r\n    // '/hub/add' - Create new school\r\n    api.post('/add', (req, res) => {\r\n        let newHub = new School();\r\n        newHub.hubName = req.body.hubName;\r\n        newHub.save(err => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json({message: newHub.hubName + ' has been created successfully'});\r\n        });\r\n    });\r\n\r\n    // '/hub' - Read all schools\r\n    api.get('/', (req, res) => {\r\n        School.find({}, (err, hub) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(hub);\r\n        });\r\n    });\r\n\r\n    // '/hub/teachers/:schoolId' - Read all teachers\r\n    api.get('/teachers/:schoolId', (req, res) => {\r\n        School.findById(req.params.schoolId, (err, school) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(school.teachers);\r\n        });\r\n    });\r\n\r\n    // '/hub/students/:schoolId' - Read all students\r\n    api.get('/students/:schoolId', (req, res) => {\r\n        School.findById(req.params.schoolId, (err, school) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(school.students);\r\n        });\r\n    });\r\n\r\n    // '/hub/update' - Update\r\n    api.put('/update', (req, res) => {\r\n        School.find({}, (err, hub) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            hub.hubName = req.body.roomName;\r\n            hub.save(err => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                res.json({message: hub.hubName + ' info updated'});\r\n            });\r\n        });\r\n    });\r\n\r\n    // '/hub/remove' - Delete\r\n    api.delete('/remove/:id', (req, res) => {\r\n        School.remove({_id: req.params.id}, (err, deletedHub) => {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            let idClassRooms = deletedHub.classrooms;\r\n            let idTeachers = deletedHub.teachers;\r\n            let idStudents = deletedHub.students;\r\n            Classroom.remove(idClassRooms, (err, classrooms) => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n            });\r\n            Teacher.remove(idTeachers, (err, teachers) => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n            });\r\n            Student.remove(idStudents, (err, students) => {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n            });\r\n            res.json({message: \"Classroom successfully removed\"});\r\n        });\r\n    });\r\n\r\n    return api;\r\n}"]}