{"version":3,"sources":["homeroom.js"],"names":["Object","defineProperty","exports","value","_mongoose","require","_mongoose2","_interopRequireDefault","_express","_hub","_hub2","_homeroom","_homeroom2","_teacher","_teacher2","_student","_student2","obj","__esModule","default","_ref","config","db","api","Router","homeroomCount","post","req","res","findById","params","hubId","err","hub","send","newHomeroom","roomName","body","_id","save","homeroom","homerooms","push","json","message","hubName","get","next","find","roomId","put","undefined","delete","id","homeroomName","pull","remove","teachers","students"],"mappings":"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","file":"homeroom.js","sourcesContent":["'use strict';\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\n\r\nvar _mongoose = require('mongoose');\r\n\r\nvar _mongoose2 = _interopRequireDefault(_mongoose);\r\n\r\nvar _express = require('express');\r\n\r\nvar _hub = require('../model/hub');\r\n\r\nvar _hub2 = _interopRequireDefault(_hub);\r\n\r\nvar _homeroom = require('../model/homeroom');\r\n\r\nvar _homeroom2 = _interopRequireDefault(_homeroom);\r\n\r\nvar _teacher = require('../model/teacher');\r\n\r\nvar _teacher2 = _interopRequireDefault(_teacher);\r\n\r\nvar _student = require('../model/student');\r\n\r\nvar _student2 = _interopRequireDefault(_student);\r\n\r\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\r\n\r\nexports.default = function (_ref) {\r\n    var config = _ref.config,\r\n        db = _ref.db;\r\n\r\n    var api = (0, _express.Router)();\r\n    var homeroomCount = 0;\r\n\r\n    // '/homeroom/:hubId' - Create new homeroom\r\n    api.post('/create/:hubId', function (req, res) {\r\n        _hub2.default.findById(req.params.hubId, function (err, hub) {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            var newHomeroom = new _homeroom2.default();\r\n            newHomeroom.roomName = req.body.roomName;\r\n            newHomeroom.hub = hub._id;\r\n            newHomeroom.save(function (err, homeroom) {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                hub.homerooms.push(newHomeroom);\r\n                hub.save(function (err) {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                });\r\n                homeroom.save(function (err) {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                    res.json({ message: newHomeroom.roomName + ' successfully added to ' + hub.hubName });\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    // '/homeroom/' - Read all homerooms\r\n    api.get('/', function (req, res, next) {\r\n        _homeroom2.default.find({}, function (err, homeroom) {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(homeroom);\r\n        });\r\n    });\r\n\r\n    // '/homeroom/:roomId' - Read homeroom by id\r\n    api.get('/:roomId', function (req, res) {\r\n        //.findById method\r\n        _homeroom2.default.findById(req.params.roomId, function (err, homeroom) {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            res.json(homeroom);\r\n        });\r\n    });\r\n\r\n    // '/homeroom/:roomId' - Update homeroom\r\n    api.put('/update/:roomId', function (req, res) {\r\n        _homeroom2.default.findById(req.params.roomId, function (err, homeroom) {\r\n            if (err) {\r\n                res.send(err);\r\n            }\r\n            if (req.body.roomName !== undefined) {\r\n                homeroom.roomName = req.body.roomName;\r\n            }\r\n            homeroom.save(function (err) {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                res.json({ message: homeroom.roomName + ' info updated' });\r\n            });\r\n        });\r\n    });\r\n\r\n    // '/homeroom/:roomId' - Remove homeroom\r\n    api.delete('/remove/:roomId', function (req, res) {\r\n        var id = req.params.roomId;\r\n        _homeroom2.default.findById(id, function (err, homeroom) {\r\n            var homeroomName = homeroom.roomName;\r\n            _hub2.default.find({ homerooms: id }, function (err, hub) {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                hub.homerooms.pull(homeroom);\r\n                hub.save(function (err) {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                });\r\n            });\r\n            _homeroom2.default.remove({ _id: req.params.roomId }, function (err, homeroom) {\r\n                if (err) {\r\n                    res.send(err);\r\n                }\r\n                id = homeroom.teachers;\r\n                _teacher2.default.remove(id, function (err) {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                });\r\n                id = homeroom.students;\r\n                _student2.default.remove(id, function (err) {\r\n                    if (err) {\r\n                        res.send(err);\r\n                    }\r\n                });\r\n                homeroomCount--;\r\n                res.json({ message: homeroomName + \" successfully removed\" });\r\n            });\r\n        });\r\n    });\r\n\r\n    return api;\r\n};\r\n//# sourceMappingURL=homeroom.js.map"]}