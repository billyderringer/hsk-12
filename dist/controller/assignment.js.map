{"version":3,"sources":["../../src/controller/assignment.js"],"names":["api","post","req","res","findById","params","subjectId","err","subject","send","newAssignment","title","body","description","assignmentType","correctAnswers","incorrectAnswers","grade","teacher","term","student","_id","save","assignments","push","json","message","get","find","assignmentId","assignment","console","log","patch","undefined","delete","id","pull","remove"],"mappings":"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","file":"assignment.js","sourcesContent":["import {Router} from 'express'\r\nimport { authenticate } from '../middleware/authMiddleware'\r\nimport Subject from '../model/subject'\r\nimport Assignment from '../model/assignment'\r\n\r\nexport default () => {\r\n    let api = Router()\r\n\r\n    // '/assignment/...' Create new assignment\r\n    api.post('/create/:subjectId', authenticate, (req, res) => {\r\n        Subject.findById(req.params.subjectId, (err, subject) => {\r\n            if(err){\r\n                res.send(err+' :err finding subject by id')\r\n            }\r\n            let newAssignment = new Assignment()\r\n            newAssignment.title = req.body.title\r\n            newAssignment.description = req.body.description\r\n            newAssignment.assignmentType = req.body.assignmentType\r\n            newAssignment.correctAnswers = req.body.correctAnswers\r\n            newAssignment.incorrectAnswers = req.body.incorrectAnswers\r\n            newAssignment.grade = req.body.grade\r\n            newAssignment.teacher = subject.teacher\r\n            newAssignment.term = subject.term\r\n            newAssignment.student = subject.student\r\n            newAssignment.subject = subject._id\r\n            newAssignment.save(err => {\r\n                if (err) {\r\n                    res.send(err+' :err saving new subject')\r\n                }\r\n                subject.assignments.push(newAssignment)\r\n                subject.save(err => {\r\n                    if(err){\r\n                        res.send(err+' :err saving assignment to subject')\r\n                    }\r\n                    res.json({message: 'new assignment saved'})\r\n                })\r\n            })\r\n        })\r\n    })\r\n\r\n    // Get assignments by subjectId\r\n    api.get('/subject/:subjectId', (req, res) => {\r\n        Assignment.find({subject: req.params.subjectId}, (err, assignments) => {\r\n            if(assignments === null){\r\n                res.json('assignments not found')\r\n            }\r\n            else if (err) {\r\n                res.send(err)\r\n            }\r\n            else {\r\n                res.json(assignments)\r\n            }\r\n        })\r\n    })\r\n\r\n    //Get assignment by id\r\n    api.get('/:assignmentId', (req, res) => {\r\n        Assignment.findById(req.params.assignmentId, (err, assignment) => {\r\n            console.log(assignment)\r\n            if(assignment === null){\r\n                res.json('assignment not found')\r\n            }\r\n            else if (err) {\r\n                res.send(err);\r\n            }\r\n            else {\r\n                res.json(assignment);\r\n            }\r\n        });\r\n    })\r\n\r\n    // Update assignment basic info\r\n    api.patch('/update/:assignmentId', authenticate, (req, res) => {\r\n        Assignment.findById(req.params.assignmentId, (err, assignment) => {\r\n            if (err) {\r\n                res.send(err)\r\n            }\r\n            if (req.body.title !== undefined) {\r\n                assignment.title = req.body.title\r\n            }\r\n            if (req.body.description !== undefined) {\r\n                assignment.description = req.body.description\r\n            }\r\n            if (req.body.assignmentType !== undefined) {\r\n                assignment.assignmentType = req.body.assignmentType\r\n            }\r\n            if (req.body.correctAnswers !== undefined) {\r\n                assignment.correctAnswers = req.body.correctAnswers\r\n            }\r\n            if (req.body.incorrectAnswers !== undefined) {\r\n                assignment.incorrectAnswers = req.body.incorrectAnswers\r\n            }\r\n            if (req.body.grade !== undefined) {\r\n                assignment.grade = req.body.grade\r\n            }\r\n\r\n            assignment.save(err => {\r\n                if (err) {\r\n                    res.send(err)\r\n                }\r\n                res.json({message: 'assignment info updated successfully'})\r\n            })\r\n        })\r\n    })\r\n\r\n    // Delete assignment\r\n    api.delete('/remove/:assignmentId', authenticate, (req, res) => {\r\n        let id = req.params.assignmentId\r\n\r\n        Assignment.findById(id, (err, assignment) => {\r\n            if (err) {\r\n                res.send(err + ' :err finding assignment by id')\r\n            }\r\n            Subject.find({assignments: id}, (err, subject) => {\r\n                if (err) {\r\n                    res.send(err + ' :err finding subject by assignmentId')\r\n                }\r\n                subject[0].assignments.pull(assignment)\r\n                subject[0].save(err => {\r\n                    if (err) {\r\n                        res.send(err + ' :err saving subject')\r\n                    }\r\n                })\r\n            })\r\n            Assignment.remove({_id: req.params.assignmentId}, err => {\r\n                if (err) {\r\n                    res.send(err + ' :err removing Assignment')\r\n                }\r\n            })\r\n        })\r\n        res.json({message: \"assignment successfully removed\"})\r\n    })\r\n\r\n    return api\r\n}"]}